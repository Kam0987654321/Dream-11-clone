"use strict";(function(){var r;r=angular.module("ui.bootstrap.showErrors",[]),r.directive("showErrors",["$timeout","showErrorsConfig","$interpolate",function(r,t,i){var n,u,e;return u=function(r){var i;return i=t.trigger,r&&null!=r.trigger&&(i=r.trigger),i},n=function(r){var i;return i=t.showSuccess,r&&null!=r.showSuccess&&(i=r.showSuccess),i},e=function(t,e,s,F){var o,h,a,l,c,g,f,D;if(o=!1,c=t.$eval(s.showErrors),g=n(c),D=u(c),h=e[0].querySelector(".form-control[name]"),l=angular.element(h),a=i(l.attr("name")||"")(t),!a)throw"show-errors element has no child input elements with a 'name' attribute and a 'form-control' class";return l.bind(D,function(){return o=!0,f(F[a].$invalid)}),t.$watch(function(){return F[a]&&F[a].$invalid},function(r){if(o)return f(r)}),t.$on("show-errors-check-validity",function(){return f(F[a].$invalid)}),t.$on("show-errors-reset",function(){return r(function(){return e.removeClass("has-error"),e.removeClass("has-success"),o=!1},0,!1)}),f=function(r){if(e.toggleClass("has-error",r),g)return e.toggleClass("has-success",!r)}},{restrict:"A",require:"^form",compile:function(r,t){if(t.showErrors.indexOf("skipFormGroupCheck")===-1&&!r.hasClass("form-group")&&!r.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return e}}}]),r.provider("showErrorsConfig",function(){var r,t;r=!1,t="blur",this.showSuccess=function(t){return r=t},this.trigger=function(r){return t=r},this.$get=function(){return{showSuccess:r,trigger:t}}})}).call(this);var validateForms=angular.module("formValidations",[]);validateForms.service("userDetailValidations",function(){this.error={},this.propsWithLimitOnLength={},this.propsWithLimitOnMinLength={},this.isValidEmail=function(r){var t=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return t.test(r)},this.isValidDate=function(r){return"Invalid Date"!==new Date(r)&&!isNaN(new Date(r))},this.limitOnMinLength=function(r,t,i){return this.propsWithLimitOnMinLength[t]?null:this.propsWithLimitOnMinLength[t]=i,!(!r[t]||!r[t].length)&&i<r[t].length},this.limitOnLength=function(r,t,i){return this.propsWithLimitOnLength[t]?null:this.propsWithLimitOnLength[t]=i,!!(r[t]&&r[t].length&&r[t].length>i)&&(r[t]=r[t].slice(0,i),i==r[t].length)},this.acceptOnlyNumber=function(r,t){if(!(r&&r[t]&&r[t].length>0))return!0;var i=r[t][r[t].length-1];isNaN(i)&&(r[t]=r[t].slice(0,r[t].length-1))},this.isValid=function(r,t,i){var n="undefined"!=typeof t[i]&&""!=t[i]&&!r[i].$error.required&&!r[i].$error[i];return n&="email"!=i||this.isValidEmail(t[i]),n&="dob"!=i||this.isValidDate(t[i]),n&=!this.propsWithLimitOnLength[i]||t[i].length==this.propsWithLimitOnLength[i],n&=!this.propsWithLimitOnMinLength[i]||t[i].length>=this.propsWithLimitOnMinLength[i]},this.setError=function(r,t){this.error[r]=t},this.hasError=function(r){return!!this.error[r]}});
!function(){function e(){return{restrict:"E",scope:{isOTPSent:"=otpSent",template:"@",mobile:"@",title:"@"},controller:["$scope","TB","$interval","$rootScope",t],templateUrl:"/views/partials/components/mobile-verification-template.html"}}function t(e,t,i,o){var n,a=30,r="call",l="SMS",s="",c=a;e.student={mobile:""},e.otp="",e.timeLeftString=a.toString(),e.otpSentVia=l,e.otpResent=!1,e.otpResentCount=0,e.maxOTPResendAllowed=6,e.activateResendOTPBtns=!1,e.activeLoader="",e.loader={resentOTP:"resendOTPLoader",OTPViaCall:"OTPViaCallLoader",verifyOTP:"verifyOTPLoader"};var d=function(t,o,r){n&&(i.cancel(n),e.activateResendOTPBtns=!1,e.timeLeftString=a.toString()),n=i(function(){c-=1,e.timeLeftString=c>9?""+c:"0"+c,0===c&&r()},t,o)},m=function(){e.activateResendOTPBtns=!0,e.timeLeftString=a.toString()};e.toggleCurrentState=function(){e.isOTPSent=!e.isOTPSent,e.otpResentCount=0,e.isOTPSent&&s&&(e.student.mobile=s)},e.sendOTP=function(i,o){var n=function(){e.activeLoader="",e.isOTPSent=!0,i||o?(e.otpResent=!0,e.otpResentCount=e.otpResentCount+1):(forceSessionRefresh(),e.otpResentCount=0,e.otpResent=!1),c=a,d(1e3,a,m)},s=function(t){e.activeLoader="",showAlert(t&&t.message||"There was a problem sending OTP. Please retry.","error","small",5e3)};o?(e.activeLoader=e.loader.OTPViaCall,e.otpSentVia=r):(e.activeLoader=e.loader.resentOTP,e.otpSentVia=l);var f={mobile:"91"+e.student.mobile,onCall:!!o};t.updateMobile(f,n,s)},e.verifyOTP=function(i){var n=function(t){e.activeLoader="",o.$broadcast(MOBILE_SUCCESSFULLY_VERIFIED,{mobile:e.student.mobile}),forceSessionRefresh()},a=function(t){e.activeLoader="",showAlert(t&&t.message||"Failed to verify otp. Please retry!","error","small",5e3)};e.activeLoader=e.loader.verifyOTP;var r={otp:i};t.verifyOtp(r,n,a)};var f=function(t){t&&t.data&&(t.data.mobileVerified?(e.student.mobile=t.data.mobileVerified.slice(2),s=t.data.mobileVerified.slice(2)):e.student.mobile=t.data.mobile?t.data.mobile.slice(2):"")},u=function(){e.student.mobile=e.mobile?12===e.mobile.length?e.mobile.slice(2):e.mobile:"",e.isOTPSent&&e.mobile?d(1e3,a,m):e.mobile||(e.isOTPSent=!1,TB.GetStudentFromStorage(f))};u()}angular.module("mobileVerification",["Testbook"]).directive("verifyMobile",e)}();
var TB=TB||{};TB.LS_KEY_TXN_TEST_COUNT="txn_test_count",TB.LS_KEY_TXN_AMOUNT="txn_amount",TB.LS_KEY_TXN_COUPON_USED="txn_coupon";var app=app||{};app.controller("cartCtrl",["$scope","TB","$rootScope",function(o,e,t){function r(){var o=0,e=0,t=setInterval(function(){6===o?clearInterval(t):(e=$(".js-cart-mobile-verify").outerHeight()||0,$(".js-cart-body").css("margin-top",e),o+=1)},500)}o.getRoundedFloat=function(o,e){return getRoundedFloat(o,e)},t.$on("SET_MY_COINS",function(e,t){o.mycoins=t.mycoins});var s=JSON.parse($("#course_info")&&$("#course_info").val()||"[]"),n=function(o){for(var e={},t=0;t<o.length;t++)if(o[t].isGroup&&o[t].courses)for(var r=0;r<o[t].courses.length;r++)o[t].courses[r].abbr.toLowerCase()&&(e[o[t].courses[r].abbr.toLowerCase()]=o[t].courses[r].id);else o[t].abbr.toLowerCase()&&(e[o[t].abbr.toLowerCase()]=o[t].id);return e},i=n(s),c=[],a=function(o){o=validateArr(o);for(var e=[],t="",r=0;r<o.length;r++)for(var s=0;o[r].exams&&s<o[r].exams.length;s++)t=i[o[r].exams[s].toLowerCase()],t&&e.indexOf(t)===-1&&e.push(t);return e};o.isLiveTestPromotions=!1,t.$on("ADD_TO_CART",function(e,s){o.liveTestIdForPromotions=s.liveTestIdForPromotions||"",o.checkForMobileVerification();var n=s.cartItemsArr||[];if(c=a(n),o.mycoins=s.mycoins,o.coinsPercentage=s.coinsPercentage,s.isAddWithCoins||o.cartObj.isAddCoinsCHK)for(var i=0;i<n.length;i++)o.unlockTestsWithCoins(n[i]);else o.addToCart(n);var u=o.getItemIdsArrFromItemsArr(n);s.isSyncWithServer&&o.syncWithServer("add",u),o.manageFlyout(s.isOpenFlyout),t.$emit("SET_REMAINING_COINS",{coins:o.mycoins-o.coinsToUse}),r()}),t.$on("REMOVE_FROM_CART",function(e,t){o.removeFromCart(t.idsArr),o.manageFlyout(t.isOpenFlyout)}),t.$on(MOBILE_SUCCESSFULLY_VERIFIED,function(e,t){o.isMobileVerified=!0,document.getElementById("mobile-verification-status").value=1,r()}),t.$on("GET_REMAINING_COINS",function(e,r){t.$emit("CHECK_FOR_PRODUCTS_WITH_COINS_CALLBACK",{coins:o.mycoins-o.coinsToUse})}),o.$on("$includeContentLoaded",function(){$(".js-cart-contents").on("click",".js-cart-mobile-verify",function(){r()})}),o.getItemIdsArrFromItemsArr=function(o){o=o&&o.length&&o;for(var e=[],t=0;t<o.length;t++)e.push(o[t].id);return e},o.checkForDupclicateItems=function(o,e){for(var t={},r=[],s=0;s<o.length;s++)t[o[s][e]]||(t[o[s][e]]=o[s]);for(var n in t)n&&t[n]&&r.push(t[n]);return r},o.coupon={},o.coupon.code="",o.mycoins=0,o.isCartOpen=!1,o.cartItemsArr=[],o.cartObj={isAddCoinsCHK:!1},o.addToCart=function(e){for(var t=0;t<e.length;t++)o.checkIfProductAlreadyExist(o.cartItemsArr,e[t],"id")||(e[t].isSubscription="Subscription Bundle"==e[t].type,o.cartItemsArr.push(e[t]));o.calculateCartVariables()},o.removeFromCart=function(e,r){o.syncWithServer("remove",e),o.cartObj.isAddCoinsCHK=!1,o.setCoins(),o.resetCouponComponent();for(var s=[],n=o.cartItemsArr.length-1;n>=0;n--){var i=e.indexOf(o.cartItemsArr[n].id);i==-1&&s.push(o.cartItemsArr[n])}o.cartItemsArr=s,o.calculateCartVariables(),t.$emit("REMOVED_FROM_CART",{idsArr:e}),t.$emit("SET_REMAINING_COINS",{coins:o.mycoins-o.coinsToUse})},o.syncWithServer=function(t,r){for(var s=[],n=0;n<o.cartItemsArr.length;n++)if(r.indexOf(o.cartItemsArr[n].id)!=-1){var i=o.cartItemsArr[n],c={title:i.title,cost:i.cost,pid:i.id,task:t};i.items&&i.items[0].products&&i.items[0].products.length&&(c.products=i.items[0].products),i.items&&i.items[0].tests&&i.items[0].tests.length&&(c.tests=i.items[0].tests),s.push(c)}s=o.validateArrStructrueForSync(s);var a=function(o){for(var e=0;e<s.length;e++)"add"==s[e].task&&TBAnalytics.hooks.addToCart(s[e]),"remove"==s[e].task&&TBAnalytics.hooks.removeFromCart(s[e])},u=function(o){return 0},d={cart:{products:s},client:"web"};e.saveProfile(d,a,u)},o.validateArrStructrueForSync=function(o){for(var e=[],t=0;t<o.length;t++)o[t]&&o[t].pid&&o[t].title&&o[t].cost&&o[t].task&&e.push(o[t]);return e},o.unlockTestsWithCoins=function(e){return e.cost*o.coinsPercentage/100>o.mycoins-o.coinsToUse?0:(o.checkIfProductAlreadyExist(o.cartItemsArr,e,"id")||o.cartItemsArr.push(e),o.couponCodePrice=0,o.couponCode="",o.couponStage=1,o.isCouponAdded=!1,o.cartObj.isAddCoinsCHK=!0,o.coinsToUse=0,o.calculateCartVariables(),void o.addCoins("",!0))},o.resetTestCart=function(){for(var e=[],r=0;r<o.cartItemsArr.length;r++)o.cartItemsArr[r].isPresentInCart=!1,e.push(o.cartItemsArr[r].id);o.coinsToUse=0,o.cartObj.isAddCoinsCHK=!1,o.removeCoupon(0),o.syncWithServer("remove",e),o.calculateCartVariables(),t.$emit("SET_REMAINING_COINS",{coins:o.mycoins-o.coinsToUse}),t.$broadcast("REMOVED_FROM_CART",{idsArr:e}),o.cartItemsArr=[],o.subTotal=0,o.calculateCartVariables()},o.checkIfProductAlreadyExist=function(o,e,r){for(var s=0;s<o.length;s++)if(o[s][r]==e.id)return!0;if(e.items&&e.items[0]&&e.items[0].products)for(var n=e.items[0].products||[],s=0;s<o.length;s++){var i=o[s].items[0].products||[],c=[o[s].items[0].pid];i=i.concat(c);for(var a=0;a<i.length;a++)if(n.indexOf(i[a])!=-1||n.indexOf(o[s].id)!=-1)return t.$emit("REMOVED_FROM_CART",{idsArr:e.id}),showAlert("Combo/Pack with some same tests is already added to the Cart","error","sm",7e3),!0}for(var n=e.items[0].products||[],s=0;s<o.length;s++)if(o[s].items[0]&&o[s].items[0].products&&o[s].items[0].products.indexOf(e.id)!=-1)return t.$emit("REMOVED_FROM_CART",{idsArr:e.id}),showAlert("Combo/Pack with some same tests is already added to the Cart","error","sm",7e3),!0;return!1},o.couponStage=0,o.showCouponInputBox=function(){return o.cartObj.isAddCoinsCHK?(o.couponInactiveMessage="Use either coins or coupon",setTimeout(function(){o.couponInactiveMessage=""},3e3),!0):void(o.couponStage=1)},o.calculateCartVariables=function(){o.subTotal=0,o.remCost=0;for(var e=0;e<o.cartItemsArr.length;e++){var t=o.cartItemsArr[e];o.subTotal=o.subTotal+t.cost,o.remCost=o.remCost+t.cost}o.remCost=o.remCost-o.getAppliedCoupon();var r=o.getAddedCoins();o.remCost=o.remCost-r},o.isAddedByUser=!1,o.getAddedCoins=function(){return o.coinsToUse},o.setCoins=function(){if(o.cartObj.isAddCoinsCHK){if(o.mycoins>o.remCost*o.coinsPercentage/100)return o.coinsToUse=getRoundedFloat(o.remCost*o.coinsPercentage/100,0),o.coinsToUse;if(o.mycoins<=o.remCost*o.coinsPercentage/100)return o.coinsToUse=o.mycoins,o.coinsToUse}else o.coinsToUse=0},o.getAppliedCoupon=function(){return o.couponCodePrice},o.coinsToUse=0,o.getPaymentObj=function(e){o.coinsToUse=void 0!=o.coinsToUse?o.coinsToUse:0,o.coupon.code=void 0!=o.coupon.code?o.coupon.code:"";for(var t={coins:o.coinsToUse,coupon:o.coupon.code,products:[],ismobile:!1},r=0;r<e.length;r++){var s=e[r];t.products.push(s.id)}return t.products=t.products.join(","),t},o.errorMessageCoupon="",o.isCouponAdded=!1,o.applyCoupon=function(t){return o.coupon.code=t,0==o.cartItemsArr.length?(o.errorMessageCoupon="Your cart is empty",o.hideCouponErrorMsg(),0):""==o.coupon.code?(o.errorMessageCoupon="Please enter valid coupon code",o.hideCouponErrorMsg(),0):(o.isCouponAdded=!0,o.productObject=o.getPaymentObj(o.cartItemsArr),showLoader("Validating Coupon, Please Wait."),void e.applyCoupon(o.productObject,o.applyCouponSCB,o.applyCouponFCB))},o.couponCodePrice=0,o.applyCouponSCB=function(e){return hideLoader(),o.couponCodePrice=e.data.discount,o.couponCodePrice<=0?(o.removeCoupon(1),o.errorMessageCoupon="this coupon not applicable on selected products.",o.hideCouponErrorMsg(),0):(o.couponStage=2,o.coinsToUse>0&&(o.cartObj.isAddCoinsCHK=!1,o.coinsToUse=0),o.calculateCartVariables(),void(o.isDisabledCoins=!0))},o.isDisabledCoins=!1,o.couponInactiveMessage="",o.applyCouponFCB=function(e){hideLoader(),o.coupon.code="",o.errorMessageCoupon=e.message||"Unknown server error.",o.hideCouponErrorMsg()},o.removeCoupon=function(e){return o.cartObj.isAddCoinsCHK=!1,o.coinsToUse=0,o.couponCodePrice=0,o.coupon.code="",o.couponStage=e,o.isCouponAdded=!1,o.isDisabledCoins=!1,o.calculateCartVariables(),0},o.resetCouponComponent=function(){o.couponStage=0,o.coupon.code="",o.couponCodePrice=0},o.showCartErrorPopup=function(){return""!=o.errorMessageCoupon},o.hideCouponErrorMsg=function(){setTimeout(function(){o.errorMessageCoupon=""},3e3)},o.remCost=0,o.isCoinsAdded=!1,o.cartObj.isAddCoinsCHK=!1,o.coinsInactiveMessage="",o.showCoinsInactiveMessage=function(){return!!o.isDisabledCoins&&(o.coinsInactiveMessage="Use either coins or coupons",setTimeout(function(){o.coinsInactiveMessage=""},3e3),!0)},o.addCoins=function(e,r){return e="",o.cartObj.isAddCoinsCHK=r,0==o.cartItemsArr.length?(o.hideCoinsErrorMsg(),0):(o.setCoins(),o.resetCouponComponent(),o.calculateCartVariables(),void t.$emit("SET_REMAINING_COINS",{coins:o.mycoins-o.coinsToUse}))};var u=!0;o.isLoading=!1,o.makePayment=function(t){var r=[],s=[];t&&(o.coinsToUse=o.mycoins>o.subTotal*o.coinsPercentage/100?getRoundedFloat(o.subTotal*o.coinsPercentage/100,0):o.mycoins);for(var n=0;n<o.cartItemsArr.length;n++){var i=o.cartItemsArr[n];0==i.cost?r.push(i.testId):(u=!1,s.push(i))}var c=o.getPaymentObj(s);c.tests=r.join(","),c.livetestid=o.liveTestIdForPromotions||"",c.pg=0,(c.products.length||r.length)&&(o.isLoading=!0,setLocalStorage(TB.LS_KEY_TXN_TEST_COUNT,c.products.length,1),setLocalStorage(TB.LS_KEY_TXN_AMOUNT,o.remCost,1),setLocalStorage(TB.LS_KEY_TXN_COUPON_USED,o.coupon.code,1),d.pack=c,e.manageTransactions(c,o.makePaymentSCB,o.makePaymentFCB),TBAnalytics.hooks.checkoutStart());var a=function(o,e,t,r,s){for(var n=window.location.href,i=!0,c=0;c<e.length;c++)if(n.indexOf(e[c])==-1){i=!1;break}i&&o.on("click",function(){TBAnalytics.hooks.event(t,r,s,1)})},l=function(o,e){var t=$(".cart-payment>.btn-success-mt");t.each(function(t,r){a($(r),o,"Pay","Click",e+" - Pay")})};l(["/bank-po/mocktest"],"Bank PO"),l(["/ssc/mocktest"],"SSC CGL")},o.getValidatedObjectForPayment=function(o){for(var e=[],t=0;t<o.length;t++)o[t]&&o[t].cost&&o[t].id&&o[t].title&&o[t].type&&o[t].items&&o[t].items.length&&e.push(e);return e};var d={};o.makePaymentSCB=function(e){if(hideLoader(),e&&e.success&&e.data)if(o.isLoading=!1,e.data.isFree){for(var t=0;t<o.cartItemsArr.length;t++){var r=o.cartItemsArr[t];o.myTestsCount=o.myTestsCount+1,r.isPartOfMyTests=!0,r.isPartOfAllTests=!1,o.manageFlyout(!1),o.showEmptyBag=!1}o.testCountAdded=o.cartItemsArr.length,o.isFreeTestAdded=!0}else d.data=e.data||{},d.csCourseIds=c.join(),o.$broadcast("openRazorpayPrompt",d),o.manageFlyout(!1)},o.makePaymentFCB=function(e){o.isLoading=!1,showAlert(e&&e.message||"Something went wrong, Please try again.","error","sm",5e3),hideLoader()},o.getProceedBtnClass=function(){return 0==o.coinsToUse&&0==o.couponCodePrice&&0==o.remCost?"pay-state-0":o.coinsToUse>0&&o.remCost-o.couponCodePrice>0||o.remCost>0?"pay-state-1":o.coinsToUse>0&&0==o.remCost?"pay-state-2":"pay-state-0"},o.manageFlyout=function(e){o.isCartOpen=e,o.toggleBodyScroll(e)},o.includeMobilVerificationBlock=!1,o.checkForMobileVerification=function(){o.isMobileVerified=parseInt(document.getElementById("mobile-verification-status").value||"0"),o.isMobileVerified||(o.includeMobilVerificationBlock=!0)}}]);
var app=app||{},TB=TB||{};app.controller("paymentCtrl",["$scope","TB",function(t,e){t.compName="Testbook";var a=$("#stuname")&&$("#stuname").val()||"TB_Anon",o=$("#email")&&$("#email").val()||"tb_anon@testbook.com",n=$("#mobile")&&$("#mobile").val().slice(2)||"9876543210",r="razorpay_payment_id",s="razorpay_order_id",i="razorpay_signature",l="",p="";t.paytmObj={otp:"",data:{mobile:""},description:""},t.isOpenPaytmErrorBox=!1;var c=function(){t.isEnterOtpView=!1,t.isFailedAttempt=!1,t.isLoading=!1,t.statusText="Sending OTP to "+n},m=function(t,a){var o={courses:t},n=function(){forceSessionRefresh(),setCookie("tb_txnid",a),window.location.href="/tests"},r=function(t){t&&t.message&&""!==t.message?(showAlert(t.message,"error","small",3e3),setCookie("tb_txnid",a),window.location.href="/tests"):showAlert("Please check your internet connection or contact at support@testbook.com","error","large",5e3)};e.enrollInCourse(o,n,r)},d=function(t){for(var e=p.split(","),a=0;a<t.length;a++)t[a].course&&e.indexOf(t[a].course.id)!==-1&&e.splice(e.indexOf(t[a].course.id),1);p=e.join(",")},u=function(t){if(t.hasOwnProperty("message"))showAlert(t.message||"Something went wrong please contact at support@testbook.com","error","small",5e3);else{var e=t.data||{};d(e.enrollments||[])}};t.$on("openRazorpayPrompt",function(t,e){e.data.hasOwnProperty("url")?window?window.location.href=e.data.url:showAlert("Please refresh the page to see your tests","error","small",5e3):(p=e.csCourseIds||"",TB.GetStudentFromStorage(u),O(e))});var y=function(t){m(p,t)},g=function(t){t.isMobile=!1;var a=function(t){t&&t.data?y(t.data.transaction||""):showAlert(t&&t.message||"Something went wrong.","danger","large",5e3)},o=function(t){showAlert("Something went wrong!","danger","small",2e3)};e.razorPayCaptureCheckout(t,a,o)},f=function(){t.statusText="Waiting for payment confirmation.";var a=function(e){e&&e.data?y(e.data.transaction):(t.closePayTMModal(),showAlert(e&&e.message||"Something went wrong.","danger","large",5e3))},o=function(e){t.closePayTMModal(),showAlert(e&&e.message||"Something went wrong.","danger","large",5e3)};w.pg=2,e.manageTransactions(w,a,o)};t.verifyOtpForPaytm=function(){t.isLoading=!0,t.statusText="Verifying OTP",t.isEnterOtpView=!1;var a=function(e){if(e&&e.success&&e.data){var a=e.data.balance||0;a>=t.paytmObj.data.amount/100?f():(t.statusText="Balance : "+a,t.isFailedAttempt=!0)}},o=function(e){t.statusText="Entered OTP was incorrect. Re-enter to proceed.",t.paytmObj.otp="",t.isLoading=!1,t.isEnterOtpView=!0},n={otp:t.paytmObj.otp};e.verifyOtpForPaytm(n,a,o)},t.hidePaytmShowRazorpay=function(){$(".razorpay-container").css("display","block"),$("#seamlessPaytm").modal("hide")},t.otpInputFocused=!1,t.otpInputFilled=!1,t.validateOtpLength=function(){t.paytmObj.otp?0==t.paytmObj.otp.length?t.otpInputFilled=!1:t.paytmObj.otp.length>0?t.otpInputFilled=!0:6==t.paytmObj.otp.length&&$(".otp").blur():t.otpInputFilled=!1},t.closePayTMModal=function(){$("#seamlessPaytm").addClass("fade").modal("hide").on("hidden.bs.modal",function(){$(this).removeClass("fade")}),$(".razorpay-container").css("display","none"),h()},t.genOtpForPaytm=function(){t.paytmObj.otp="",t.isEnterOtpView=!1,t.isLoading=!0,t.statusText="Sending OTP to "+t.paytmObj.data.mobile,t.isOpenPaytmErrorBox=!1;var a=function(e){e&&e.data&&(t.isLoading=!1,t.isEnterOtpView=!0,t.statusText="An OTP has been sent on "+t.paytmObj.data.mobile)},o=function(e){t.isOpenPaytmErrorBox=!0,e||showAlert("Please check your internet connection.","error","small",2e3)};e.genOtpForPaytm({mobile:t.paytmObj.data.mobile},a,o)};var h=function(){var t={};t[s]=l,t[r]="",t[i]="";var a=function(t){t&&t.data},o=function(t){t?t.hasOwnProperty("message")?showAlert(t.message,"error","small",2e3):showAlert("Something went wrong!","error","small",2e3):showAlert("Please check your internet connection.","error","small",2e3)};e.razorPayCaptureCheckout(t,a,o)},w={},O=function(e){w=e.pack||{},w.txnId=e.data.transaction||"";var r=e.data.razorpayClientParams||{};l=r.order_id||"",t.paytmObj.description=r.description;var s={key:r.key||"",amount:r.amount||0,name:r.name||"",description:r.description||"",image:"/assets/img/brand/logo-small.png",handler:function(t){g(t||{})},order_id:r.order_id||"",prefill:{name:a,email:o,contact:n},theme:{color:"#16d4d9"},external:{wallets:["paytm"],handler:function(e){t.paytmObj.data=e||{},t.paytmObj.data.mobile=e.contact||"9876543210",$("#seamlessPaytm").modal("show"),$(".razorpay-container").css("display","none"),c(),t.genOtpForPaytm()}},modal:{ondismiss:function(){h()},escape:!1}},i=new Razorpay(s);i.open()}}]);
var app=app||{};app.controller("releasePlanCtrl",["$scope","$rootScope","TB","subscriptionService",function(t,e,a,s){t.statusClass="",t.notificationTextArr=s.notificationArr,t.featuresArr=[],e.$on("TOGGLE_RELEASE_PLAN_MODAL",function(e,a){o(a.toOpen,a.toMature),t.extraFeatures=a.data||[]}),e.$on("TOGGLE_RELEASE_PLAN_MATURITY",function(t,e){i(e.toMature)});var i=function(e){t.statusClass=e?"in mature":"in"},o=function(e){t.statusClass=e?"in":"",e||s.handleMaturityOfModal(!0),s.handleBodyScroll()};t.hideReleasePlan=function(){o(!1)},t.testPackBtnClicked=function(t,e){t=validateArr(t);for(var a=[],i=0;i<t.length;i++)a.push(t[i].pid||"");s.testPackBtnClicked(a.join(","),e)};var r=function(t){return parseInt(t)!=t&&!isNaN(new Date(t).getTime())};t.isValidDate=function(t){return r(t)},t.getDateObj=function(t){return new Date(t)},t.sortFunction=function(t,e){for(var a=0;a<t.length;a++)for(var s=t[a].children||[],i=0;i<s.length;i++)"datetime"==s[i].type.toLowerCase()&&(t[a].sortValue=new Date(s[i].title).getTime()||(new Date).getTime());return sortFunction(t,"sortValue","number","asc")}}]),app.controller("calculateSavingsCtrl",["$scope","$rootScope","TB","subscriptionService",function(t,e,a,s){t.statusClass=!1,t.isShowCalc=!1,t.subsObj={},e.$on("TOGGLE_CALCULATE_SAVINGS_MODAL",function(e,a){t.subsObj=a.subsObj,t.subscriptionTotal={cost:0,baseCost:0,testCount:0,baseTestCount:0,eachTestCost:0,tidsObj:{},commonTids:{}},t.calcTotal={cost:0,baseCost:0,testCount:0,baseTestCount:0,eachTestCost:0,tidsObj:{},commonTids:{}},t.isCalcBtnDisabled=!0,t.toggleModal(a.toOpen),t.calcData=o(a.data[0]||[]),t.chooseCourseUIDS=i(a.data[1]||[])}),t.toggleModal=function(e){t.statusClass=e?t.statusClass?"in mature":"in":"",e||s.handleMaturityOfModal(!0),s.handleBodyScroll()},t.subscribeNowBtnClicked=function(){s.purchaseSubscriptionEventFire(t.subsObj)};var i=function(t){for(var e=[],a={},s=0,i=0,o=0;o<t.length;o++){i=0,s=Math.ceil(t[o].exams.length/3),a={},a.course=t[o].course,a.isChecked=!1,a.examsUI=[];for(var r=0;r<s;r++)a.examsUI.push([t[o].exams[i]&&{title:t[o].exams[i].title,isChecked:!1}||{},t[o].exams[i+1]&&{title:t[o].exams[i+1].title,isChecked:!1}||{},t[o].exams[i+2]&&{title:t[o].exams[i+2].title,isChecked:!1}||{}]),i+=3;e.push(a)}return e};t.isPreferred=!0;var o=function(e){for(var a=[],s={},i=0;i<e.length;i++)s={},s.title=e[i].title,s.cost=e[i].cost,s.testCount=e[i].testCount,s.isChecked=e[i].isChecked||!1,s.testArrObj=e[i].testArrObj||[],a.push(s),c(t.subscriptionTotal,s.testArrObj,!0),t.subscriptionTotal.testCount=Object.keys(t.subscriptionTotal.tidsObj).length;return t.subscriptionTotal.cost=t.subsObj.hasOwnProperty("newCost")?t.subsObj.newCost:t.subsObj.cost,t.subscriptionTotal.testCount=t.subscriptionTotal.baseTestCount-n(t.subscriptionTotal.commonTids||{}),t.subscriptionTotal.eachTestCost=Math.round(t.subscriptionTotal.cost/t.subscriptionTotal.testCount)||0,a},r=function(t){var e=0;for(var a in t)e+=t[a].cost*t[a].count;return e},n=function(t){var e=0;for(var a in t)e+=t[a].count;return e},c=function(t,e,a){for(var s=0;s<e.length;s++)a?(t.tidsObj.hasOwnProperty(e[s].tid)?t.commonTids[e[s].tid]?t.commonTids[e[s].tid].count+=1:(t.commonTids[e[s].tid]={},t.commonTids[e[s].tid].cost=e[s].cost,t.commonTids[e[s].tid].count=1):t.tidsObj[e[s].tid]=e[s].cost,t.baseCost+=e[s].cost,t.baseTestCount+=1):t.tidsObj.hasOwnProperty(e[s].tid)&&(t.commonTids[e[s].tid]?t.commonTids[e[s].tid].count>1?t.commonTids[e[s].tid].count-=1:delete t.commonTids[e[s].tid]:delete t.tidsObj[e[s].tid],t.baseCost-=e[s].cost,t.baseTestCount-=1)};t.calculateTotal=function(e){t.isCalcBtnDisabled=!u(),e.isChecked?(c(t.calcTotal,e.testArrObj,e.isChecked),t.calcTotal.cost=t.calcTotal.baseCost-r(t.calcTotal.commonTids||{}),t.calcTotal.testCount=t.calcTotal.baseTestCount-n(t.calcTotal.commonTids||{})):(c(t.calcTotal,e.testArrObj,e.isChecked),t.calcTotal.cost=t.calcTotal.baseCost-r(t.calcTotal.commonTids||{}),t.calcTotal.testCount=t.calcTotal.baseTestCount-n(t.calcTotal.commonTids||{})),t.calcTotal.eachTestCost=Math.round(t.calcTotal.cost/t.calcTotal.testCount)||0,t.isPreferred=!t.calcTotal.cost||!(t.calcTotal.cost<t.subscriptionTotal.cost)};var l=function(t,e){for(var a=0;a<t.length;a++)t[a][0].isChecked=e,t[a][1].isChecked=e,t[a][2].isChecked=e};t.isCalcBtnDisabled=!0;var u=function(){for(var e=0;e<t.calcData.length;e++)if(t.calcData[e].isChecked)return!0;return!1},d=function(){for(var e=0;e<t.chooseCourseUIDS.length;e++)for(var a=0;a<t.chooseCourseUIDS[e].examsUI.length;a++)for(var s=0;s<t.chooseCourseUIDS[e].examsUI[a].length;s++)if(t.chooseCourseUIDS[e].examsUI[a][s].hasOwnProperty("isChecked")&&t.chooseCourseUIDS[e].examsUI[a][s].isChecked)return!1;return!0};t.checkSelectedExam=function(e){t.isCalcBtnDisabled=d();for(var a=0;a<e.examsUI.length;a++)for(var s=0;s<e.examsUI[a].length;s++)if(e.examsUI[a][s].hasOwnProperty("isChecked")&&!e.examsUI[a][s].isChecked)return void(e.isChecked=!1);e.isChecked=!0},t.checkSelectedCourse=function(e){e.isChecked?l(e.examsUI,!0):l(e.examsUI,!1),t.isCalcBtnDisabled=d()},t.hideCalcSavings=function(){t.toggleModal(!1),s.handleMaturityOfModal(),t.isShowCalc=!1},t.calculateSavingBtnClicked=function(){for(var e=0;e<t.calcData.length;e++){for(var a=0;a<t.chooseCourseUIDS.length;a++)for(var s=0;s<t.chooseCourseUIDS[a].examsUI.length;s++)t.chooseCourseUIDS[a].examsUI[s][0].title==t.calcData[e].title&&(t.calcData[e].isChecked=t.chooseCourseUIDS[a].examsUI[s][0].isChecked),t.chooseCourseUIDS[a].examsUI[s][1].title==t.calcData[e].title&&(t.calcData[e].isChecked=t.chooseCourseUIDS[a].examsUI[s][1].isChecked),t.chooseCourseUIDS[a].examsUI[s][2].title==t.calcData[e].title&&(t.calcData[e].isChecked=t.chooseCourseUIDS[a].examsUI[s][2].isChecked);t.calcData[e].isChecked&&t.calculateTotal(t.calcData[e])}t.isShowCalc=!0,scrollToTop(".modal-hero-content",400)}}]),app.controller("testPackCtrl",["$scope","$rootScope","TB","subscriptionService",function(t,e,a,s){t.notificationTextArr=s.notificationArr,t.statusClass="",t.ReleasePackDetails=[],e.$on("TOGGLE_TEST_PACK_MODAL",function(e,a){o(a.toOpen,a.toMature),t.getReleasePackDetails(a.productIds,a.status||"released")}),e.$on("TOGGLE_TEST_PACK_MATURITY",function(t,e){i(e.toMature)}),t.getReleasePackDetails=function(e,s){var i=function(t){t=validateArr(t);for(var e=0,a=0;a<t.length;a++)e+=t[a].qCount||0;return e||0},o=function(t){return{title:t.title||"",questionsCount:i(t.pattern&&t.pattern.sections)||[],releaseDate:new Date(t.availFrom),availTillDate:new Date(t.availTill)}},r=function(t){for(var e={},a=t.items||[],s={packName:t.title,productMap:{}},i=0;i<a.length;i++){var r=a[i].pattern||{};e[r.title]||(e[r.title]={value:[],patternName:r.title}),e[r.title].value.push(o(a[i]))}return s.productMap=e,s},n=function(t){for(var e={},a=0;a<t.length;a++){t[a].items||[];e[t[a]._id]=r(t[a])}return e},c=function(e){t.testDetailsLoading=!1,t.releasePackDetails=n(e.data&&e.data.products)},l=function(e){t.testDetailsLoading=!1,t.releasePackDetails={},showAlert(e.message||"Something went wrong, Please try again.","error","sm",5e3)};t.testDetailsLoading=!0,a.getReleasePackProductDetails({pids:e,status:s},c,l)};var i=function(e){t.statusClass=e?"in mature":"in"},o=function(e){t.statusClass=e?"in":"",e||s.handleMaturityOfModal(!0),s.handleBodyScroll()};t.hideTestPack=function(){o(!1)}}]),app.controller("renewPlanCtrl",["$scope","$rootScope","TB","subscriptionService",function(t,e,a,s){t.statusClass="",t.notificationTextArr=s.notificationArr,e.$on("TOGGLE_RENEW_SUBSCRIPTION_PLAN_MODAL",function(t,e){o(e.toOpen)}),e.$on("TOGGLE_RENEW_SUBSCRIPTION_PLAN_MATURITY",function(t,e){i(e.toMature)});var i=function(e){t.statusClass=e?"in mature":"in"},o=function(e){t.statusClass=e?"in":"",e||s.handleMaturityOfModal(!0),s.handleBodyScroll()};t.showCalculationPlan=function(t){s.calcSavingsBtnClicked(t,t.calcData,t.courseSelectionDS)},t.hideRenewPlanModal=function(){o(!1)}}]),app.controller("SubscriptionHIW",["$scope",function(t){t.$on("$includeContentLoaded",function(){function t(){n=new YT.Player("subscriptionVideoPlayer",{height:"505",width:"900",videoId:"DyOMTC8g3lg",enablejsapi:1,events:{onReady:e,onStateChange:a},origin:window.location.origin,playerVars:{color:"white",loop:1,rel:0,showinfo:0}})}function e(t){t.target.playVideo()}function a(t){}function s(){n.pauseVideo()}function i(){n.playVideo()}var o=document.createElement("script");o.src="https://www.youtube.com/iframe_api";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(o,r);var n,c="#subscriptionVideoPlayer",l="#subscription-helper";$(l).on("shown.bs.modal",function(){void 0===$(c).attr("src")?(t(),makeVideosResponsive()):i()}),$(l).on("hide.bs.modal",function(){s()})})}]),app.service("subscriptionService",["$rootScope","$timeout",function(t,e){this.callDataLayerFunction=function(){e(function(){"undefined"!=typeof dataLayer?(dataLayer.push({event:"api.cb"}),console.log("data-layer called with argument {'event': 'api.cb'}")):console.log("data-layer does not exist")},2e3)},this.notificationArr=["Check the test release and expiry date by clicking on the Test Release Plan link for all exams."],this.modalHeroPathStack=[],this.calcSavingsBtnClicked=function(e,a,s){this.modalHeroPathStack.push("calculator"),t.$broadcast("TOGGLE_CALCULATE_SAVINGS_MODAL",{toOpen:!0,data:[a,s],subsObj:e}),this.handleMaturityOfModal(!1)},this.releasePlanBtnClicked=function(e){this.modalHeroPathStack.push("release-plan"),t.$broadcast("TOGGLE_RELEASE_PLAN_MODAL",{toOpen:!0,data:e}),this.handleMaturityOfModal(!1)},this.testPackBtnClicked=function(e,a){this.modalHeroPathStack.push("test-pack"),t.$broadcast("TOGGLE_TEST_PACK_MODAL",{toOpen:!0,productIds:e,status:0==a?"released":"upcoming"}),this.handleMaturityOfModal(!1)},this.renewSubscriptionBtnClicked=function(){this.modalHeroPathStack.push("renew-subscription"),t.$broadcast("TOGGLE_RENEW_SUBSCRIPTION_PLAN_MODAL",{toOpen:!0}),this.handleMaturityOfModal(!1)},this.toggleCalcMaturity=function(e){t.$broadcast("",{toOpen:!0,toMature:e})},this.toggleReleaseMaturity=function(e){t.$broadcast("TOGGLE_RELEASE_PLAN_MATURITY",{toMature:e})},this.toggleTestPackMaturity=function(e){t.$broadcast("TOGGLE_TEST_PACK_MATURITY",{toMature:e})},this.toggleRenewSubMaturity=function(e){t.$broadcast("TOGGLE_RENEW_SUBSCRIPTION_PLAN_MATURITY",{toMature:e})},this.purchaseSubscriptionEventFire=function(e){t.$broadcast("PURCHASE_SUBSCRIPTION_FROM_CALCULATOR",{data:e})},this.handleMaturityOfModal=function(t){var e="";if(t)this.modalHeroPathStack.pop(),e=this.modalHeroPathStack[this.modalHeroPathStack.length-1];else{if(!(this.modalHeroPathStack.length>1))return;e=this.modalHeroPathStack[this.modalHeroPathStack.length-2]}switch(e){case"calculator":this.toggleCalcMaturity(!t);break;case"release-plan":this.toggleReleaseMaturity(!t);break;case"test-pack":this.toggleTestPackMaturity(!t);break;case"renew-subscription":this.toggleRenewSubMaturity(!t);break;case"subscription":this.toggleRenewSubMaturity(!t)}},this.getCoursesString=function(t){for(var e="",a=0;a<t.length;a++)e+=t[a].name+" . ";return e},this.isShowFromTbLogic=function(t,e,a){for(var s=!1,i=0;i<t.courses.length;i++)if(a[t.courses[i].id]&&(this.getValidDays(a[t.courses[i].id].expiry)<0||a[t.courses[i].id].validity<t.validity)){s=!0;break}return(t.courses.length>1&&s||e.isActive)&&e.cost>0},this.getDiscount=function(t,e){return t>=e?t-e:0},this.getPurchasedSubsMap=function(t){var e={};t=validateArr(t);for(var a=0;a<t.length;a++)this.subsBundleIdToObjMap[t[a]._id]&&(e[t[a]._id]={expiryInDays:this.getValidDays(t[a].expiry),expiryInDaysString:"",expiryDate:new Date(t[a].expiry),purchaseDate:new Date(new Date(t[a].expiry)-this.convertNanosecToMillisec(this.subsBundleIdToObjMap[t[a]._id].validity)),courses:t[a].courses,isExpired:!((new Date).getTime()<=new Date(t[a].expiry).getTime())},e[t[a]._id].expiryInDaysString=e[t[a]._id].expiryInDays>1?e[t[a]._id].expiryInDays+" Days":e[t[a]._id].expiryInDays+"Day");return e};var a=function(t){for(var e=0,a=0;a<t.length;a++)e+=t[a].cost;return e},s={released:"released test packs",upcoming:"upcoming test packs",expected:"expected test packs"},i=function(t){for(var e=[],i={},o={},r=0;r<t.length;r++)if((t[r].title.toLowerCase()==s.released||t[r].title.toLowerCase()==s.upcoming)&&t[r].children)for(var n=0;n<t[r].children.length;n++)for(var c=1;c<t[r].children[n].children.length;c++)i={},i.title=t[r].children[n].children[c].children[0].title,o.hasOwnProperty(i.title)?(i.testCount=parseInt(t[r].children[n].children[c].children[1].title)+e[o[i.title]].testCount,i.testArrObj=t[r].children[n].children[c].children[4].meta,i.cost=a(i.testArrObj)+e[o[i.title]].cost,i.testArrObj=i.testArrObj.concat(e[o[i.title]].testArrObj)):(i.testCount=parseInt(t[r].children[n].children[c].children[1].title),i.testArrObj=t[r].children[n].children[c].children[4].meta,i.cost=a(i.testArrObj),o[i.title]=e.length),e[o[i.title]]=i;return e},o=function(t){for(var e=[],a={},i={},o={},r=0;r<t.length;r++)if((t[r].title.toLowerCase()==s.released||t[r].title.toLowerCase()==s.upcoming)&&t[r].children)for(var n=0;n<t[r].children.length;n++)if(a={},a.course=t[r].children[n].meta.course,o.hasOwnProperty(a.course)){a.exams=e[o[a.course].pos].exams;for(var c=1;c<t[r].children[n].children.length;c++)i={},i.title=t[r].children[n].children[c].children[0].title,o[a.course].hasOwnProperty(i.title)||(o[a.course][i.title]=a.exams.length,a.exams[o[a.course][i.title]]=i);e[o[a.course].pos]=a}else{o[a.course]={pos:e.length},a.exams=[];for(var c=1;c<t[r].children[n].children.length;c++)i={},i.title=t[r].children[n].children[c].children[0].title,o[a.course].hasOwnProperty(i.title)||(o[a.course][i.title]=a.exams.length,a.exams[o[a.course][i.title]]=i);e.push(a)}return e},r=function(t,e){for(var a=0,s=0;s<e.length;s++)t.hasOwnProperty(e[s])&&a++;return a},n=function(t){for(var e=[],a={},i=0;i<t.length;i++)if((t[i].title.toLowerCase()==s.released||t[i].title.toLowerCase()==s.upcoming)&&t[i].children)for(var o=0;o<t[i].children.length;o++)for(var r=1;r<t[i].children[o].children.length;r++){e=t[i].children[o].children[r].children[4].meta;for(var n=0;n<e.length;n++)a[e[n].tid]=1}return a},c=function(t,e){for(var a=0,s=0;s<t.courses.length;s++)if(e.hasOwnProperty(t.courses[s].id)&&(a=new Date(e[t.courses[s].id].expiry).getTime(),a-(new Date).getTime()>0))return!0;return!1};this.processSubscriptionObject=function(t,e,a,s){s=s?s:[];var u={},d=function(t){var e=864e11;return Math.round(t/e)},h=function(e,a){if(t.isHidden)return e.isActive&&!!a&&!a.isExpired;if(0===e.cost){if(a&&a.purchaseDate){var s=new Date(a.purchaseDate).setHours(0,0,0,0),i=s+864e5;return(new Date).getTime()>=s&&(new Date).getTime()<=i}return!1}return e.cost>0};u.id=t._id||"-1",u.availTill=new Date(t.availTill)||new Date,u.category=t.category||"",u.cost=Math.round(this.calculateSubsBundleCost(t,e))||0,u.oldCost=t.oldCost||t.cost||0,u.completePackCost=t.cost||0,u.couponGoldenRatio=getRoundedFloat(u.cost/u.completePackCost,2)||1,u.coursesObjArr=t.courses||[],u.courseNamesArr=getSpecificKeyArrFromArrayOfObjects(t.courses,"name"),u.coupon=t.offerCoupon||{},u.description=t.description||"",u.pattern=u.pattern||{},u.title=t.title||"",u.recommendedFor=t.recommendedFor||"",u.offerText=0==t.cost?"FREE":u.discountText,u.type=t.type||"others",u.isActive=!!a[t._id],u.isShow=h(u,a[t._id]),u.specificExamObjArr=t.specificExams,u.cardClass=this.getSubscriptionCardClass(t),u.subTitle="",u.coursesStr=this.getCoursesString(t.courses),u.featureArr=t.features||[],u.items=t.items||[],u.discount=this.getDiscount(u.oldCost,u.cost),u.colorHex=l(t.colorHex),u.validity=this.getValidMonth(t.validity)||0,u.validityInDaysTemp=d(t.validity||0),u.validityInDaysTemp%30===0?u.validityStringTemp=u.validityInDaysTemp/30>1?u.validityInDaysTemp/30+" Months":u.validityInDaysTemp/30+" Month":u.validityStringTemp=u.validityInDaysTemp>1?u.validityInDaysTemp+" days":u.validityInDaysTemp+" day",u.validityInDays=30*u.validity||0,u.subStrInSubCard=12==u.validity?"For 1 Year":u.validity>1?"For "+u.validity+" Months":"For "+u.validity+" Month",u.validityString=u.validity>1?u.validity+" Months":u.validity+" Month",u.extraFeatures=t.extraFeatures||[],u.totalTest=this.getTotalTestInBundle(t.extraFeatures),u.calcData=i(t.extraFeatures||[]),u.courseSelectionDS=o(t.extraFeatures||[]),u.isActive&&t.hasOwnProperty("hasExtendedValidity")&&t.hasExtendedValidity&&(u.hasExtendedValidity=t.hasExtendedValidity);var p=n(t.extraFeatures||[]);return u.attemptedTest=r(p,s),u.isActive?(u.isExpired=!(new Date(a[u.id].expiryDate).getTime()-(new Date).getTime()>0),u.isExpired?u.statusClass="subs-expired":(u.attemptedPercent=Math.round(100*u.attemptedTest/u.totalTest).toString()+"%",u.statusClass="subs-active")):c(t,e)?u.statusClass="subs-inactive subs-upgrade":u.statusClass="subs-inactive",u};var l=function(t){return t=t?t:"ffffff",t.indexOf("#")!=-1?t:"#"+t};this.mockTestSubsFilter=function(t,e,a){var s=[],i="";for(var o in e)e[o].expiryInDays<=0&&(i+=this.getCoursesString(e[o].courses));for(var r=0;r<a.length;r++)e[a[r].id]&&e[a[r].id].expiryInDays>0||i.trim()&&a[r].coursesStr.toLowerCase().indexOf(t.toLowerCase())!=-1&&a[r].coursesStr.toLowerCase().indexOf(i.toLowerCase())!=-1&&s.push(a[r]);return s},this.getTotalTestInBundle=function(t){t=validateArr(t);for(var e=0,a=0;a<t.length;a++)if((t[a].title.toLowerCase()==s.released||t[a].title.toLowerCase()==s.upcoming)&&t[a].children)for(var i=0;i<t[a].children.length;i++)e+=parseInt(t[a].children[i].meta.testCount);return e},this.getValidMonth=function(t){var e=2592e12;return Math.round(t/e)},this.getValidDays=function(t){var e=new Date(t).getTime()-(new Date).getTime();return Math.round(e/864e5)},this.getSubscriptionCardClass=function(t){var e="subs-inactive";return e},this.getCoursesString=function(t){for(var e=[],a=0;a<t.length;a++)e.push(t[a].name);return e.join(" . ")},this.subsBundleIdToObjMap={},this.convertNanosecToMillisec=function(t){return t/1e6},this.calculateSubsBundleCost=function(t,e){var a={},s=0,i=1,o=t.validity,r=t.items||[],n=0;if(r.length)for(var c=0;c<r.length;c++)a=this.subsBundleIdToObjMap[r[c].id]||{},n+=a.cost,s+=this.calculateSubsCost(a,e,o);else n=t.cost,s=t.cost;return i=t.cost/n,s*i},this.calculateSubsCost=function(t,e,a){if(t.courses&&e.hasOwnProperty(t.courses[0].id)){var s=e[t.courses[0].id].expiry-(new Date).getTime(),i=this.convertNanosecToMillisec(a);if(s>i)return 0;s<0&&(s=0);var o=0;return i-s>0&&(o=(i-s)/i),t.cost*o}return t.cost||0},this.getCourseToExpiryMap=function(t){var e={};t=validateArr(t);for(var a=0;a<t.length;a++)for(var s=0;s<t[a].courses.length;s++)if(e.hasOwnProperty(t[a].courses[s].id)){var i=e[t[a].courses[s].id].expiry,o=new Date(t[a].expiry).getTime();o>i&&(e[t[a].courses[s].id].expiry=o,e[t[a].courses[s].id].subsId=t[a]._id)}else e[t[a].courses[s].id]={},e[t[a].courses[s].id].expiry=new Date(t[a].expiry).getTime(),e[t[a].courses[s].id].subsId=t[a]._id;return e},this.handleBodyScroll=function(){this.modalHeroPathStack&&this.modalHeroPathStack.length>=1?$("body").addClass("modal-open"):$("body").removeClass("modal-open")},this.getRoundedToTens=function(t){return t=Math.floor(t),t+=9,t=10*Math.floor(t/10),t=t%10>=5?t+10:t}}]);
var TB=TB||{};!function(){function e(e,n){function s(e){if(window){var r=e+"-practice",o=window.location.href||"",t=o.split("//").length&&o.split("//")[1]||"";window.location.search&&(t=t.split("?")[0]);var n=t.split("/");n.splice(0,1);var s=n[0],a=d+"-practice",i="";s===d?(n[0]=e,i="/"+n.join("/"),window.location.href=i):s===a?(i="/"+r,window.location.href=i):window.location.reload()}}function a(e){showLoader("Changing Course. Please wait.");var r=function(r){forceSessionRefresh(!0);var o={id:e.id||"",name:e.name||""};TB.UpdateCurrentCourseInStorage(o),s(e.url)},o=function(e){e?showAlert(e.message||"Something went wrong, Please contact at support@testbook.com","error","large",5e3):showAlert("Please check your internet connection or contact at support@testbook.com","error","large",5e3),hideLoader()},t={course:e.id};n.setCurrentCourse(t,r,o)}var i="/tb-money",c={},u=$("#sid")&&$("#sid").val()||-1,l=Object.prototype.hasOwnProperty;this.tbCourseArr=JSON.parse($("#course_info")&&$("#course_info").val()||"[]"),this.showStuCourseDropdown=!0;var d=document.getElementById("curCourseURL")&&document.getElementById("curCourseURL").value||"";this.stuObj={isShowCoBrandingLogo:!1,coBrandingLogoSrc:"",currentCourseObj:{},enrollmentsArr:[],profilePic:"",isLoggedIn:isLoggedIn()||!1,tbMoney:0},this.updateCurrentCourse=function(e){return a(e),!1};var g={},f=this,h=function(e){var r={id:e,name:g[e]&&g[e].abbr||"",url:g[e]&&g[e].URL||""};return r},p=function(e,r){for(var o=0;o<e.length;o++)if(e[o].course&&e[o].course.id==r)return o;return-1};e.$on(r,function(e,r){r&&(f.stuObj.currentCourseObj=h(r.courseId||""))}),e.$on(t,function(e,r){r&&(f.showStuCourseDropdown=!1)}),e.$on(o,function(e,r){if(r)if(r.isEnrolled){var o={course:h(r.courseId||"")};Object.keys(o).length&&f.stuObj.enrollmentsArr.push(o)}else{var t=p(f.stuObj.enrollmentsArr,r.courseId||"");t!==-1&&f.stuObj.enrollmentsArr.splice(t,1)}});var b=function(e){for(var r={},o=0;o<e.length;o++)if(e[o].isGroup)for(var t=0;t<e[o].courses.length;t++)r[e[o].courses[t].id]=e[o].courses[t];else r[e[o].id]=e[o];return r},O=function(e){for(var r=[],o=0;o<e.length;o++)g[e[o].course.id]&&(e[o].course.url=g[e[o].course.id].URL,e[o].course.hasOwnProperty("isInactive")&&e[o].course.isInactive||r.push(e[o]));return r};this.isShowNav=function(e){return e!==i||this.stuObj&&0!==this.stuObj.tbMoney};var m=function(){var e=function(e){if(e.hasOwnProperty("message"))showAlert(e.message||"Something went wrong please contact at support@testbook.com","error","small",5e3);else{c=e.data||{};var r=l.call(c,"streaks")&&l.call(c.streaks,"practise")&&l.call(c.streaks.practise,"coins"),o=l.call(c,"streaks")&&l.call(c.streaks,"questions")&&l.call(c.streaks.questions,"coins");l.call(c,"cobrandingInfo")&&c.cobrandingInfo.logo&&(f.stuObj.coBrandingLogoSrc=c.cobrandingInfo.logo,f.stuObj.isShowCoBrandingLogo=!0),l.call(c,"currentCourse")&&c.currentCourse.id&&(f.stuObj.currentCourseObj=c.currentCourse),l.call(c,"image")&&c.image&&(f.stuObj.profilePic=c.image),l.call(c,"enrollments")&&c.enrollments.length&&(f.stuObj.enrollmentsArr=O(c.enrollments)),l.call(c,"referral")&&l.call(c.referral,"coins")&&(f.stuObj.tbMoney+=c.referral.coins),r&&(f.stuObj.tbMoney+=c.streaks.practise.coins),o&&(f.stuObj.tbMoney+=c.streaks.questions.coins),l.call(c,"coinsExpensed")&&(f.stuObj.tbMoney-=c.coinsExpensed),l.call(c,"referral")&&(f.stuObj.referral=c.referral)}};g=b(f.tbCourseArr),"-1"!=u&&TB.GetStudentFromStorage(e)};angular.element(document).ready(function(){$(".js-group-one, #js-header-options-sidebar .course-btn").click(function(e){e.stopPropagation(),e.preventDefault(),$(this).toggleClass("active"),$(this).parent().children("ul").slideToggle()})}),m()}var r="COURSE_CHANGED",o="COURSE_ENROLLED_DE_ENROLLED",t="REMOVE_STU_COURSE_DROPDOWN",n=angular.module("tbHeaderApp",["Testbook"]);n.controller("headerCtrl",["$scope","TB",e])}();
var TB=TB||{};!function(){function e(){return{restrict:"E",scope:{},controller:["$scope","TB",t],templateUrl:"/views/partials/components/subfooter-seo.html"}}function t(e,t){var o=function(){return{anchorTag:"",link:""}},n=function(){return{title:"",links:[]}},s=function(){return{id:"",URL:"",type:"",name:"",sections:[],SEO:{title:"",description:"",keywords:[],URL:"",rel:[]}}},r="absent",i=window.location.host+window.location.pathname,a="ls_seo",c={};e.isSubFooterPresent=!1,e.subFooterSections=[];var l=function(e){for(var t=[],s=0;s<e.length;s++){var r=n();r.title=e[s].title||"";for(var i=0;i<e[s].links.length;i++){var a=o();a.link=e[s].links[i].link||"",a.anchorTag=e[s].links[i].anchorTag||"",r.links.push(a)}t.push(r)}return t},u=function(){var o=function(t){if(t.data.hasOwnProperty("id")&&""!==t.data.id){t=t.data;var o=s();o.id=t.id,o.URL=t.URL||"",o.type=t.pageType||"",o.name=t.name||"",o.sections=l(t.sections||[]),e.subFooterSections=o.sections,e.subFooterSections.length&&(e.isSubFooterPresent=!0),c[i]=o,setLocalStorage(a,JSON.stringify(c),.5)}},n=function(e){e&&e.message&&e.message.indexOf("SEO does not exists")!==-1&&(c[i]=r,setLocalStorage(a,JSON.stringify(c),.5))};if(c=JSON.parse(getLocalStorage(a)||"{}"),c.hasOwnProperty(i))c.PAGE_URL!==r?(e.subFooterSections=c[i].sections||[],e.subFooterSections.length&&(e.isSubFooterPresent=!0)):c.PAGE_URL===r&&(e.isSubFooterPresent=!1);else{var u={url:i,fields:"URL,name,pageType,sections"};t.getPageSEO(u,o,n)}};u()}var o=angular.module("SEO",["Testbook"]);o.directive("subFooter",e)}();
$(document).ready(function(){var e=$(".faq-box .question");e.on("click",function(){var t=$(this).siblings(".answer");t.hasClass("active")?(e.removeClass("active"),t.removeClass("active").slideUp()):(e.removeClass("active"),$(this).addClass("active"),$(".faq-box .answer").removeClass("active").slideUp(),t.addClass("active").slideDown())})});var app=angular.module("subscriptionPlansApp",["Testbook","formValidations","tbHeaderApp","mobileVerification","SEO"]);app.controller("subscriptionPlansController",["$scope","TB","subscriptionService","$rootScope",function(e,t,s,a){var r="headerText",i={subscription:"Subscription",subscriptionBundle:"Subscription Bundle"};e.sid=-1,document.getElementById("sid")&&(e.sid=document.getElementById("sid").value),e.hideBodyScroll=!1,e.toggleBodyScroll=function(t){e.hideBodyScroll=t},e.isAnyPlanActive=!1,e.isAnyPlanVisible=!1,a.$on("PURCHASE_SUBSCRIPTION_FROM_CALCULATOR",function(t,s){e.purchaseSubsBtnClicked(s.data)}),a.$on("REMOVED_FROM_CART",function(e,t){for(var a=0;a<t.idsArr.length;a++)if(s.subsBundleIdToObjMap[t.idsArr[a]])for(var r=0;r<s.subsBundleIdToObjMap[t.idsArr[a]].courses.length;r++)n.hasOwnProperty(s.subsBundleIdToObjMap[t.idsArr[a]].courses[r].name)&&delete n[s.subsBundleIdToObjMap[t.idsArr[a]].courses[r].name]});var o=function(t){var s,a={};return s={id:t.id,cost:t.cost,title:t.title,type:t.type,exams:Object.keys(n),items:u(t),availTill:1e6*new Date(t.availTill).getTime(),validity:t.validity,validityInString:t.validityString},a={cartItemsArr:[s],isOpenFlyout:!0,isSyncWithServer:!0,mycoins:b,coinsPercentage:e.coinsPercentage}};e.purchaseSubsBtnClicked=function(t){if(e.sid!=-1){for(var s=!1,i=getURLParameterValue("pid"),c={},u=0;u<t.coursesObjArr.length;u++){if(n.hasOwnProperty(t.coursesObjArr[u].name)){s=!0;break}n[t.coursesObjArr[u].name]=1}s?t.id==i?(c=o(t),a.$broadcast("ADD_TO_CART",c)):showAlert("You can't add two products with atleast one course common","warning","medium",5e3):(c=o(t),a.$broadcast("ADD_TO_CART",c))}else{var l={};l[REDIRECT_URL_KEY]="/plans?pid="+t.id,l[r]="Sign up to subscribe courses",openSignUpSignInModal(l,!1)}};var n={},c=function(t){var r=[];if(t&&t.data&&t.data.cart&&t.data.cart.products){for(var i={cartItemsArr:t.data.cart.products,isOpenFlyout:!1,mycoins:b,isAddWithCoins:!1,isSyncWithServer:!1,coinsPercentage:e.coinsPercentage},o=0;o<i.cartItemsArr.length;o++){if(r.push(i.cartItemsArr[o].pid),i.cartItemsArr[o].id=i.cartItemsArr[o].pid,i.cartItemsArr[o].items=[{pid:i.cartItemsArr[o].pid}],s.subsBundleIdToObjMap[i.cartItemsArr[o].id]&&(i.cartItemsArr[o].validityInString=s.getValidMonth(i.cartItemsArr[o].validity)>1?s.getValidMonth(i.cartItemsArr[o].validity)+" Months":s.getValidMonth(i.cartItemsArr[o].validity)+" Month",i.cartItemsArr[o].exams))for(var c=0;c<i.cartItemsArr[o].exams.length;c++)n[i.cartItemsArr[o].exams[c]]=1;i.cartItemsArr[o].products&&(i.cartItemsArr[o].items[0].products=i.cartItemsArr[o].products),i.cartItemsArr[o].tests&&(i.cartItemsArr[o].items[0].tests=i.cartItemsArr[o].tests),delete i.cartItemsArr[o].pid,delete i.cartItemsArr[o].products,delete i.cartItemsArr[o].tests}i&&i.cartItemsArr&&i.cartItemsArr.length&&a.$broadcast("ADD_TO_CART",i)}},u=function(e){for(var t=[],s=[],a=0;a<e.items.length;a++)s.push(e.items[a].id);return t.push({pid:e.id,products:s}),t};e.releasePlanBtnClicked=function(e){s.releasePlanBtnClicked(e)},e.calcSavingsBtnClicked=function(e){s.calcSavingsBtnClicked(e,e.calcData,e.courseSelectionDS)};var l=function(t,a,r,i){t=validateArr(t);for(var o=[],n={},c=0;c<t.length;c++)n=s.processSubscriptionObject(t[c],a,r,i),n.isActive&&!n.isExpired&&(e.isAnyPlanActive=n.isActive),n.isShow&&(e.isAnyPlanVisible=!0),o.push(n);return o},d=function(e){for(var t in e)e[t].validity=e[t]&&s.subsBundleIdToObjMap[e[t].subsId]&&s.subsBundleIdToObjMap[e[t].subsId].validity;return e},p={},m=function(a,r,o,n){var u=function(t){t.data&&t.success&&(e.coinsPercentage=t.data.coinsPercentage||70,s.subsBundleIdToObjMap=getCustomMap(t.data.products,"_id","",!0),a=d(a),c(n),e.purchasedSubsMap=s.getPurchasedSubsMap(r),e.subsUIArrObj=l(t.data.products,a,e.purchasedSubsMap,o),p=getCustomMap(e.subsUIArrObj,"id","",!0),I(p,e.purchasedSubsMap),e.sid!=-1?y():(hideLoader(),s.callDataLayerFunction()))},m=function(e){console.log(e),hideLoader(),showAlert("Something went wrong, please contact support@testbook.com","danger","medium",5e3)};t.getSubsPlan({types:i.subscription+","+i.subscriptionBundle},u,m)},b=0,h=function(){var e=function(e){if(e.data&&e.success){var t=s.getCourseToExpiryMap(e.data.subscriptions),a=e.data.subscriptions||[],r=e.data.attemptedTests||[];b=e.data.coins,m(t,a,r,e)}},a=function(e){console.log(e),hideLoader(),showAlert("Something went wrong, please contact support@testbook.com","danger","medium",5e3)};t.getStuSubsPlan({},e,a)},y=function(){var a=function(t){t.data&&t.success&&(e.planUIArrObj=f(t.data),hideLoader(),s.callDataLayerFunction())},r=function(e){console.log(e),hideLoader(),showAlert("Something went wrong, please contact support@testbook.com","danger","medium",5e3)};t.getStuProducts({},a,r)},v=function(e,t){for(var s=0,a=0;a<e.length;a++)s+=t[e[a].id]&&e[a].id&&t[e[a].id].items.length||1;return s},f=function(e){for(var t=e.subscribedProducts||[],a=e.productDetails?getCustomMap(e.productDetails,"_id","",!0):{},r=[],i={},o=0;o<t.length;o++)i={},a[t[o].pid]&&("Combo Pack"==a[t[o].pid].type?i.testCount=v(a[t[o].pid].items,a):i.testCount=a[t[o].pid]&&t[o].pid&&a[t[o].pid].items.length||1,i.title=a[t[o].pid].title,i.expiry=new Date(a[t[o].pid].availTill),i.cost=a[t[o].pid].cost,i.desc=t[o]&&t[o].sourceId&&s.subsBundleIdToObjMap[t[o].sourceId]&&s.subsBundleIdToObjMap[t[o].sourceId].title,i.addedOn=new Date(t[o].addedOn)),r.push(i);return r};e.getRoundedFloat=function(e,t){return getRoundedFloat(e,t)};var g=function(){showLoader("Loading..."),e.sid!=-1?h():m({},[])},A={left:[{q:"What is a Subscription Plan?",a:{type:"text",value:[{u:"",p:"With Subscription Plans, you will be able to access all the tests in your subscribed courses. It includes all the tests that are already present on the platform and also the tests that wil be released during the subscription period.For example, if you subscribe to Banking and Insurance (12 Month Subscription Plan), you can take all the tests available in Bank PO, Bank Clerk, Bank SO, RBI and Insurance courses. This also includes all test packs that will be released in future for upcoming exams. All Tests will be based on latest patterns. Please note that we assume 30 days per month."}]}},{q:"Who should buy the Subscription Plan?",a:{type:"text",value:[{u:"",p:"Students who plan to appear for multiple exams in coming months must go for subscription plan as it will give them access to hundreds of mocktest for practice to improve their speed and accuracy. Students who are preparing for general competition should opt for one of the subscription plans."}]}},{q:"Why should I buy a subscription plan?",a:{type:"list",value:[{u:"Be ready for all the exams.",p:" Just with a click, add and take as many mock tests as you can for your exams including Sectional Tests, Prelims Full Tests, Mains Full Tests and Live Tests or any other test that you see in your subscribed course."},{u:"Save your money",p:" and access top quality mock tests for all your exams. Subscription Plans could be much cheaper for you than buying individual test packs. Check your savings here."},{u:"Pay only once",p:" and stay free from hassle of purchasing test series again and again for each exam separately."}]}}],right:[{q:"Do I need to buy some test packs separately if I have bought a subscription plan?",a:{type:"text",value:[{u:"",p:"No, you will not have to pay any amount separately to add any test pack in your My Tests for all the courses covered in your subscription plan."}]}},{q:"Can I buy multiple subscription plans?",a:{type:"text",value:[{u:"",p:"Yes, you can. "}]}},{q:"Will I be able to access my tests after my subscription expires?",a:{type:"text",value:[{u:"",p:"You should attempt all your tests before your subscription expires. You will be able to access solution and analysis of attempted tests. After expiry of your subscription plan, you will have to renew your subscription to access unattempted and new tests."}]}},{q:"Will all of my attempted test be available during the subscription period?",a:{type:"text",value:[{u:"",p:"You will be able to access all your attempted test till the test expiry date. Test expiry date is independent of subscription expiry date."}]}}]};e.faqsCol1=A.left||[],e.faqsCol2=A.right||[];var I=function(t,s){var a=getURLParameterValue("pid");if(a){if(s[a]&&!t[a].isExpired)return void showAlert("You have already purchased this product","danger","medium",5e3);if(!t[a])return void showAlert("This product is not valid","danger","medium",5e3);e.purchaseSubsBtnClicked(t[a])}};g()}]);